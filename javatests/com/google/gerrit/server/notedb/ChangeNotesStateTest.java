begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|// Copyright (C) 2018 The Android Open Source Project
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// Licensed under the Apache License, Version 2.0 (the "License");
end_comment

begin_comment
comment|// you may not use this file except in compliance with the License.
end_comment

begin_comment
comment|// You may obtain a copy of the License at
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// http://www.apache.org/licenses/LICENSE-2.0
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// Unless required by applicable law or agreed to in writing, software
end_comment

begin_comment
comment|// distributed under the License is distributed on an "AS IS" BASIS,
end_comment

begin_comment
comment|// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
end_comment

begin_comment
comment|// See the License for the specific language governing permissions and
end_comment

begin_comment
comment|// limitations under the License.
end_comment

begin_package
DECL|package|com.google.gerrit.server.notedb
package|package
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|notedb
package|;
end_package

begin_import
import|import static
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|truth
operator|.
name|Truth
operator|.
name|assertThat
import|;
end_import

begin_import
import|import static
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|truth
operator|.
name|extensions
operator|.
name|proto
operator|.
name|ProtoTruth
operator|.
name|assertThat
import|;
end_import

begin_import
import|import static
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|proto
operator|.
name|testing
operator|.
name|SerializedClassSubject
operator|.
name|assertThatSerializedClass
import|;
end_import

begin_import
import|import static
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|notedb
operator|.
name|ChangeNotesState
operator|.
name|Serializer
operator|.
name|toByteString
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|ImmutableList
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|ImmutableListMultimap
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|ImmutableMap
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|ImmutableSet
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|ImmutableTable
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|Iterables
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|common
operator|.
name|data
operator|.
name|SubmitRecord
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|common
operator|.
name|data
operator|.
name|SubmitRequirement
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|mail
operator|.
name|Address
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|reviewdb
operator|.
name|client
operator|.
name|Account
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|reviewdb
operator|.
name|client
operator|.
name|Change
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|reviewdb
operator|.
name|client
operator|.
name|ChangeMessage
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|reviewdb
operator|.
name|client
operator|.
name|Comment
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|reviewdb
operator|.
name|client
operator|.
name|LabelId
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|reviewdb
operator|.
name|client
operator|.
name|PatchSet
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|reviewdb
operator|.
name|client
operator|.
name|PatchSetApproval
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|reviewdb
operator|.
name|client
operator|.
name|RevId
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|reviewdb
operator|.
name|converter
operator|.
name|ChangeMessageProtoConverter
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|reviewdb
operator|.
name|converter
operator|.
name|PatchSetApprovalProtoConverter
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|reviewdb
operator|.
name|converter
operator|.
name|PatchSetProtoConverter
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|ReviewerByEmailSet
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|ReviewerSet
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|ReviewerStatusUpdate
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|cache
operator|.
name|proto
operator|.
name|Cache
operator|.
name|ChangeNotesStateProto
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|cache
operator|.
name|proto
operator|.
name|Cache
operator|.
name|ChangeNotesStateProto
operator|.
name|ChangeColumnsProto
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|cache
operator|.
name|proto
operator|.
name|Cache
operator|.
name|ChangeNotesStateProto
operator|.
name|ReviewerByEmailSetEntryProto
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|cache
operator|.
name|proto
operator|.
name|Cache
operator|.
name|ChangeNotesStateProto
operator|.
name|ReviewerSetEntryProto
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|cache
operator|.
name|proto
operator|.
name|Cache
operator|.
name|ChangeNotesStateProto
operator|.
name|ReviewerStatusUpdateProto
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|cache
operator|.
name|serialize
operator|.
name|ObjectIdConverter
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|notedb
operator|.
name|ChangeNotesState
operator|.
name|ChangeColumns
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|notedb
operator|.
name|ChangeNotesState
operator|.
name|Serializer
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|testing
operator|.
name|GerritBaseTests
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|inject
operator|.
name|TypeLiteral
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|protobuf
operator|.
name|ByteString
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Type
import|;
end_import

begin_import
import|import
name|java
operator|.
name|sql
operator|.
name|Timestamp
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|org
operator|.
name|eclipse
operator|.
name|jgit
operator|.
name|lib
operator|.
name|ObjectId
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Before
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import

begin_class
DECL|class|ChangeNotesStateTest
specifier|public
class|class
name|ChangeNotesStateTest
extends|extends
name|GerritBaseTests
block|{
DECL|field|ID
specifier|private
specifier|static
specifier|final
name|Change
operator|.
name|Id
name|ID
init|=
operator|new
name|Change
operator|.
name|Id
argument_list|(
literal|123
argument_list|)
decl_stmt|;
DECL|field|SHA
specifier|private
specifier|static
specifier|final
name|ObjectId
name|SHA
init|=
name|ObjectId
operator|.
name|fromString
argument_list|(
literal|"1234567812345678123456781234567812345678"
argument_list|)
decl_stmt|;
DECL|field|SHA_BYTES
specifier|private
specifier|static
specifier|final
name|ByteString
name|SHA_BYTES
init|=
name|ObjectIdConverter
operator|.
name|create
argument_list|()
operator|.
name|toByteString
argument_list|(
name|SHA
argument_list|)
decl_stmt|;
DECL|field|CHANGE_KEY
specifier|private
specifier|static
specifier|final
name|String
name|CHANGE_KEY
init|=
literal|"Iabcdabcdabcdabcdabcdabcdabcdabcdabcdabcd"
decl_stmt|;
DECL|field|cols
specifier|private
name|ChangeColumns
name|cols
decl_stmt|;
DECL|field|colsProto
specifier|private
name|ChangeColumnsProto
name|colsProto
decl_stmt|;
annotation|@
name|Before
DECL|method|setUp ()
specifier|public
name|void
name|setUp
parameter_list|()
throws|throws
name|Exception
block|{
name|cols
operator|=
name|ChangeColumns
operator|.
name|builder
argument_list|()
operator|.
name|changeKey
argument_list|(
operator|new
name|Change
operator|.
name|Key
argument_list|(
name|CHANGE_KEY
argument_list|)
argument_list|)
operator|.
name|createdOn
argument_list|(
operator|new
name|Timestamp
argument_list|(
literal|123456L
argument_list|)
argument_list|)
operator|.
name|lastUpdatedOn
argument_list|(
operator|new
name|Timestamp
argument_list|(
literal|234567L
argument_list|)
argument_list|)
operator|.
name|owner
argument_list|(
name|Account
operator|.
name|id
argument_list|(
literal|1000
argument_list|)
argument_list|)
operator|.
name|branch
argument_list|(
literal|"refs/heads/master"
argument_list|)
operator|.
name|subject
argument_list|(
literal|"Test change"
argument_list|)
operator|.
name|isPrivate
argument_list|(
literal|false
argument_list|)
operator|.
name|workInProgress
argument_list|(
literal|false
argument_list|)
operator|.
name|reviewStarted
argument_list|(
literal|true
argument_list|)
operator|.
name|build
argument_list|()
expr_stmt|;
name|colsProto
operator|=
name|toProto
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|getColumns
argument_list|()
expr_stmt|;
block|}
DECL|method|newBuilder ()
specifier|private
name|ChangeNotesState
operator|.
name|Builder
name|newBuilder
parameter_list|()
block|{
return|return
name|ChangeNotesState
operator|.
name|Builder
operator|.
name|empty
argument_list|(
name|ID
argument_list|)
operator|.
name|metaId
argument_list|(
name|SHA
argument_list|)
operator|.
name|columns
argument_list|(
name|cols
argument_list|)
return|;
block|}
annotation|@
name|Test
DECL|method|serializeChangeKey ()
specifier|public
name|void
name|serializeChangeKey
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|changeKey
argument_list|(
operator|new
name|Change
operator|.
name|Key
argument_list|(
literal|"Ieeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setChangeKey
argument_list|(
literal|"Ieeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeCreatedOn ()
specifier|public
name|void
name|serializeCreatedOn
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|createdOn
argument_list|(
operator|new
name|Timestamp
argument_list|(
literal|98765L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setCreatedOn
argument_list|(
literal|98765L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeLastUpdatedOn ()
specifier|public
name|void
name|serializeLastUpdatedOn
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|lastUpdatedOn
argument_list|(
operator|new
name|Timestamp
argument_list|(
literal|98765L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setLastUpdatedOn
argument_list|(
literal|98765L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeOwner ()
specifier|public
name|void
name|serializeOwner
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|owner
argument_list|(
name|Account
operator|.
name|id
argument_list|(
literal|7777
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setOwner
argument_list|(
literal|7777
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeBranch ()
specifier|public
name|void
name|serializeBranch
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|branch
argument_list|(
literal|"refs/heads/bar"
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setBranch
argument_list|(
literal|"refs/heads/bar"
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeSubject ()
specifier|public
name|void
name|serializeSubject
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|subject
argument_list|(
literal|"A different test change"
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setSubject
argument_list|(
literal|"A different test change"
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeCurrentPatchSetId ()
specifier|public
name|void
name|serializeCurrentPatchSetId
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|currentPatchSetId
argument_list|(
operator|new
name|PatchSet
operator|.
name|Id
argument_list|(
name|ID
argument_list|,
literal|2
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setCurrentPatchSetId
argument_list|(
literal|2
argument_list|)
operator|.
name|setHasCurrentPatchSetId
argument_list|(
literal|true
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeNullTopic ()
specifier|public
name|void
name|serializeNullTopic
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|topic
argument_list|(
literal|null
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeEmptyTopic ()
specifier|public
name|void
name|serializeEmptyTopic
parameter_list|()
throws|throws
name|Exception
block|{
name|ChangeNotesState
name|state
init|=
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|topic
argument_list|(
literal|""
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|assertRoundTrip
argument_list|(
name|state
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setTopic
argument_list|(
literal|""
argument_list|)
operator|.
name|setHasTopic
argument_list|(
literal|true
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeNonEmptyTopic ()
specifier|public
name|void
name|serializeNonEmptyTopic
parameter_list|()
throws|throws
name|Exception
block|{
name|ChangeNotesState
name|state
init|=
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|topic
argument_list|(
literal|"topic"
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|assertRoundTrip
argument_list|(
name|state
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setTopic
argument_list|(
literal|"topic"
argument_list|)
operator|.
name|setHasTopic
argument_list|(
literal|true
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeOriginalSubject ()
specifier|public
name|void
name|serializeOriginalSubject
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|originalSubject
argument_list|(
literal|"The first patch set"
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setOriginalSubject
argument_list|(
literal|"The first patch set"
argument_list|)
operator|.
name|setHasOriginalSubject
argument_list|(
literal|true
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeSubmissionId ()
specifier|public
name|void
name|serializeSubmissionId
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|submissionId
argument_list|(
literal|"xyz"
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setSubmissionId
argument_list|(
literal|"xyz"
argument_list|)
operator|.
name|setHasSubmissionId
argument_list|(
literal|true
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeAssignee ()
specifier|public
name|void
name|serializeAssignee
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|assignee
argument_list|(
name|Account
operator|.
name|id
argument_list|(
literal|2000
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setAssignee
argument_list|(
literal|2000
argument_list|)
operator|.
name|setHasAssignee
argument_list|(
literal|true
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeStatus ()
specifier|public
name|void
name|serializeStatus
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|status
argument_list|(
name|Change
operator|.
name|Status
operator|.
name|MERGED
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setStatus
argument_list|(
literal|"MERGED"
argument_list|)
operator|.
name|setHasStatus
argument_list|(
literal|true
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeIsPrivate ()
specifier|public
name|void
name|serializeIsPrivate
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|isPrivate
argument_list|(
literal|true
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setIsPrivate
argument_list|(
literal|true
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeIsWorkInProgress ()
specifier|public
name|void
name|serializeIsWorkInProgress
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|workInProgress
argument_list|(
literal|true
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setWorkInProgress
argument_list|(
literal|true
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeHasReviewStarted ()
specifier|public
name|void
name|serializeHasReviewStarted
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|reviewStarted
argument_list|(
literal|true
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setReviewStarted
argument_list|(
literal|true
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeRevertOf ()
specifier|public
name|void
name|serializeRevertOf
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|columns
argument_list|(
name|cols
operator|.
name|toBuilder
argument_list|()
operator|.
name|revertOf
argument_list|(
operator|new
name|Change
operator|.
name|Id
argument_list|(
literal|999
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
operator|.
name|toBuilder
argument_list|()
operator|.
name|setRevertOf
argument_list|(
literal|999
argument_list|)
operator|.
name|setHasRevertOf
argument_list|(
literal|true
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializePastAssignees ()
specifier|public
name|void
name|serializePastAssignees
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|pastAssignees
argument_list|(
name|ImmutableSet
operator|.
name|of
argument_list|(
name|Account
operator|.
name|id
argument_list|(
literal|2002
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|2001
argument_list|)
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addPastAssignee
argument_list|(
literal|2002
argument_list|)
operator|.
name|addPastAssignee
argument_list|(
literal|2001
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeHashtags ()
specifier|public
name|void
name|serializeHashtags
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|hashtags
argument_list|(
name|ImmutableSet
operator|.
name|of
argument_list|(
literal|"tag2"
argument_list|,
literal|"tag1"
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addHashtag
argument_list|(
literal|"tag2"
argument_list|)
operator|.
name|addHashtag
argument_list|(
literal|"tag1"
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializePatchSets ()
specifier|public
name|void
name|serializePatchSets
parameter_list|()
throws|throws
name|Exception
block|{
name|PatchSet
name|ps1
init|=
operator|new
name|PatchSet
argument_list|(
operator|new
name|PatchSet
operator|.
name|Id
argument_list|(
name|ID
argument_list|,
literal|1
argument_list|)
argument_list|)
decl_stmt|;
name|ps1
operator|.
name|setUploader
argument_list|(
name|Account
operator|.
name|id
argument_list|(
literal|2000
argument_list|)
argument_list|)
expr_stmt|;
name|ps1
operator|.
name|setRevision
argument_list|(
operator|new
name|RevId
argument_list|(
literal|"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
argument_list|)
argument_list|)
expr_stmt|;
name|ps1
operator|.
name|setCreatedOn
argument_list|(
name|cols
operator|.
name|createdOn
argument_list|()
argument_list|)
expr_stmt|;
name|ByteString
name|ps1Bytes
init|=
name|toByteString
argument_list|(
name|ps1
argument_list|,
name|PatchSetProtoConverter
operator|.
name|INSTANCE
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|ps1Bytes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|66
argument_list|)
expr_stmt|;
name|PatchSet
name|ps2
init|=
operator|new
name|PatchSet
argument_list|(
operator|new
name|PatchSet
operator|.
name|Id
argument_list|(
name|ID
argument_list|,
literal|2
argument_list|)
argument_list|)
decl_stmt|;
name|ps2
operator|.
name|setUploader
argument_list|(
name|Account
operator|.
name|id
argument_list|(
literal|3000
argument_list|)
argument_list|)
expr_stmt|;
name|ps2
operator|.
name|setRevision
argument_list|(
operator|new
name|RevId
argument_list|(
literal|"bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb"
argument_list|)
argument_list|)
expr_stmt|;
name|ps2
operator|.
name|setCreatedOn
argument_list|(
name|cols
operator|.
name|lastUpdatedOn
argument_list|()
argument_list|)
expr_stmt|;
name|ByteString
name|ps2Bytes
init|=
name|toByteString
argument_list|(
name|ps2
argument_list|,
name|PatchSetProtoConverter
operator|.
name|INSTANCE
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|ps2Bytes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|66
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|ps2Bytes
argument_list|)
operator|.
name|isNotEqualTo
argument_list|(
name|ps1Bytes
argument_list|)
expr_stmt|;
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|patchSets
argument_list|(
name|ImmutableMap
operator|.
name|of
argument_list|(
name|ps2
operator|.
name|getId
argument_list|()
argument_list|,
name|ps2
argument_list|,
name|ps1
operator|.
name|getId
argument_list|()
argument_list|,
name|ps1
argument_list|)
operator|.
name|entrySet
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addPatchSet
argument_list|(
name|ps2Bytes
argument_list|)
operator|.
name|addPatchSet
argument_list|(
name|ps1Bytes
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeApprovals ()
specifier|public
name|void
name|serializeApprovals
parameter_list|()
throws|throws
name|Exception
block|{
name|PatchSetApproval
name|a1
init|=
operator|new
name|PatchSetApproval
argument_list|(
name|PatchSetApproval
operator|.
name|key
argument_list|(
operator|new
name|PatchSet
operator|.
name|Id
argument_list|(
name|ID
argument_list|,
literal|1
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|2001
argument_list|)
argument_list|,
name|LabelId
operator|.
name|create
argument_list|(
literal|"Code-Review"
argument_list|)
argument_list|)
argument_list|,
operator|(
name|short
operator|)
literal|1
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|)
decl_stmt|;
name|ByteString
name|a1Bytes
init|=
name|toByteString
argument_list|(
name|a1
argument_list|,
name|PatchSetApprovalProtoConverter
operator|.
name|INSTANCE
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|a1Bytes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|43
argument_list|)
expr_stmt|;
name|PatchSetApproval
name|a2
init|=
operator|new
name|PatchSetApproval
argument_list|(
name|PatchSetApproval
operator|.
name|key
argument_list|(
operator|new
name|PatchSet
operator|.
name|Id
argument_list|(
name|ID
argument_list|,
literal|1
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|2002
argument_list|)
argument_list|,
name|LabelId
operator|.
name|create
argument_list|(
literal|"Verified"
argument_list|)
argument_list|)
argument_list|,
operator|(
name|short
operator|)
operator|-
literal|1
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|)
decl_stmt|;
name|ByteString
name|a2Bytes
init|=
name|toByteString
argument_list|(
name|a2
argument_list|,
name|PatchSetApprovalProtoConverter
operator|.
name|INSTANCE
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|a2Bytes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|49
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|a2Bytes
argument_list|)
operator|.
name|isNotEqualTo
argument_list|(
name|a1Bytes
argument_list|)
expr_stmt|;
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|approvals
argument_list|(
name|ImmutableListMultimap
operator|.
name|of
argument_list|(
name|a2
operator|.
name|getPatchSetId
argument_list|()
argument_list|,
name|a2
argument_list|,
name|a1
operator|.
name|getPatchSetId
argument_list|()
argument_list|,
name|a1
argument_list|)
operator|.
name|entries
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addApproval
argument_list|(
name|a2Bytes
argument_list|)
operator|.
name|addApproval
argument_list|(
name|a1Bytes
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeReviewers ()
specifier|public
name|void
name|serializeReviewers
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|reviewers
argument_list|(
name|ReviewerSet
operator|.
name|fromTable
argument_list|(
name|ImmutableTable
operator|.
expr|<
name|ReviewerStateInternal
argument_list|,
name|Account
operator|.
name|Id
argument_list|,
name|Timestamp
operator|>
name|builder
argument_list|()
operator|.
name|put
argument_list|(
name|ReviewerStateInternal
operator|.
name|CC
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|2001
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|)
operator|.
name|put
argument_list|(
name|ReviewerStateInternal
operator|.
name|REVIEWER
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|2002
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addReviewer
argument_list|(
name|ReviewerSetEntryProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setState
argument_list|(
literal|"CC"
argument_list|)
operator|.
name|setAccountId
argument_list|(
literal|2001
argument_list|)
operator|.
name|setTimestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|)
operator|.
name|addReviewer
argument_list|(
name|ReviewerSetEntryProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setState
argument_list|(
literal|"REVIEWER"
argument_list|)
operator|.
name|setAccountId
argument_list|(
literal|2002
argument_list|)
operator|.
name|setTimestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeReviewersByEmail ()
specifier|public
name|void
name|serializeReviewersByEmail
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|reviewersByEmail
argument_list|(
name|ReviewerByEmailSet
operator|.
name|fromTable
argument_list|(
name|ImmutableTable
operator|.
expr|<
name|ReviewerStateInternal
argument_list|,
name|Address
argument_list|,
name|Timestamp
operator|>
name|builder
argument_list|()
operator|.
name|put
argument_list|(
name|ReviewerStateInternal
operator|.
name|CC
argument_list|,
operator|new
name|Address
argument_list|(
literal|"Name1"
argument_list|,
literal|"email1@example.com"
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|)
operator|.
name|put
argument_list|(
name|ReviewerStateInternal
operator|.
name|REVIEWER
argument_list|,
operator|new
name|Address
argument_list|(
literal|"Name2"
argument_list|,
literal|"email2@example.com"
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addReviewerByEmail
argument_list|(
name|ReviewerByEmailSetEntryProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setState
argument_list|(
literal|"CC"
argument_list|)
operator|.
name|setAddress
argument_list|(
literal|"Name1<email1@example.com>"
argument_list|)
operator|.
name|setTimestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|)
operator|.
name|addReviewerByEmail
argument_list|(
name|ReviewerByEmailSetEntryProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setState
argument_list|(
literal|"REVIEWER"
argument_list|)
operator|.
name|setAddress
argument_list|(
literal|"Name2<email2@example.com>"
argument_list|)
operator|.
name|setTimestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeReviewersByEmailWithNullName ()
specifier|public
name|void
name|serializeReviewersByEmailWithNullName
parameter_list|()
throws|throws
name|Exception
block|{
name|ChangeNotesState
name|actual
init|=
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|reviewersByEmail
argument_list|(
name|ReviewerByEmailSet
operator|.
name|fromTable
argument_list|(
name|ImmutableTable
operator|.
name|of
argument_list|(
name|ReviewerStateInternal
operator|.
name|CC
argument_list|,
operator|new
name|Address
argument_list|(
literal|"emailonly@example.com"
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|)
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addReviewerByEmail
argument_list|(
name|ReviewerByEmailSetEntryProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setState
argument_list|(
literal|"CC"
argument_list|)
operator|.
name|setAddress
argument_list|(
literal|"emailonly@example.com"
argument_list|)
operator|.
name|setTimestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
decl_stmt|;
comment|// Address doesn't consider the name field in equals, so we have to check it manually.
comment|// TODO(dborowitz): Fix Address#equals.
name|ImmutableSet
argument_list|<
name|Address
argument_list|>
name|ccs
init|=
name|actual
operator|.
name|reviewersByEmail
argument_list|()
operator|.
name|byState
argument_list|(
name|ReviewerStateInternal
operator|.
name|CC
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|ccs
argument_list|)
operator|.
name|hasSize
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|Address
name|address
init|=
name|Iterables
operator|.
name|getOnlyElement
argument_list|(
name|ccs
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|address
operator|.
name|getName
argument_list|()
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|address
operator|.
name|getEmail
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|"emailonly@example.com"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializePendingReviewers ()
specifier|public
name|void
name|serializePendingReviewers
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|pendingReviewers
argument_list|(
name|ReviewerSet
operator|.
name|fromTable
argument_list|(
name|ImmutableTable
operator|.
expr|<
name|ReviewerStateInternal
argument_list|,
name|Account
operator|.
name|Id
argument_list|,
name|Timestamp
operator|>
name|builder
argument_list|()
operator|.
name|put
argument_list|(
name|ReviewerStateInternal
operator|.
name|CC
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|2001
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|)
operator|.
name|put
argument_list|(
name|ReviewerStateInternal
operator|.
name|REVIEWER
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|2002
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addPendingReviewer
argument_list|(
name|ReviewerSetEntryProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setState
argument_list|(
literal|"CC"
argument_list|)
operator|.
name|setAccountId
argument_list|(
literal|2001
argument_list|)
operator|.
name|setTimestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|)
operator|.
name|addPendingReviewer
argument_list|(
name|ReviewerSetEntryProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setState
argument_list|(
literal|"REVIEWER"
argument_list|)
operator|.
name|setAccountId
argument_list|(
literal|2002
argument_list|)
operator|.
name|setTimestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializePendingReviewersByEmail ()
specifier|public
name|void
name|serializePendingReviewersByEmail
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|pendingReviewersByEmail
argument_list|(
name|ReviewerByEmailSet
operator|.
name|fromTable
argument_list|(
name|ImmutableTable
operator|.
expr|<
name|ReviewerStateInternal
argument_list|,
name|Address
argument_list|,
name|Timestamp
operator|>
name|builder
argument_list|()
operator|.
name|put
argument_list|(
name|ReviewerStateInternal
operator|.
name|CC
argument_list|,
operator|new
name|Address
argument_list|(
literal|"Name1"
argument_list|,
literal|"email1@example.com"
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|)
operator|.
name|put
argument_list|(
name|ReviewerStateInternal
operator|.
name|REVIEWER
argument_list|,
operator|new
name|Address
argument_list|(
literal|"Name2"
argument_list|,
literal|"email2@example.com"
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addPendingReviewerByEmail
argument_list|(
name|ReviewerByEmailSetEntryProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setState
argument_list|(
literal|"CC"
argument_list|)
operator|.
name|setAddress
argument_list|(
literal|"Name1<email1@example.com>"
argument_list|)
operator|.
name|setTimestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|)
operator|.
name|addPendingReviewerByEmail
argument_list|(
name|ReviewerByEmailSetEntryProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setState
argument_list|(
literal|"REVIEWER"
argument_list|)
operator|.
name|setAddress
argument_list|(
literal|"Name2<email2@example.com>"
argument_list|)
operator|.
name|setTimestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeAllPastReviewers ()
specifier|public
name|void
name|serializeAllPastReviewers
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|allPastReviewers
argument_list|(
name|ImmutableList
operator|.
name|of
argument_list|(
name|Account
operator|.
name|id
argument_list|(
literal|2002
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|2001
argument_list|)
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addPastReviewer
argument_list|(
literal|2002
argument_list|)
operator|.
name|addPastReviewer
argument_list|(
literal|2001
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeReviewerUpdates ()
specifier|public
name|void
name|serializeReviewerUpdates
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|reviewerUpdates
argument_list|(
name|ImmutableList
operator|.
name|of
argument_list|(
name|ReviewerStatusUpdate
operator|.
name|create
argument_list|(
operator|new
name|Timestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|1000
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|2002
argument_list|)
argument_list|,
name|ReviewerStateInternal
operator|.
name|CC
argument_list|)
argument_list|,
name|ReviewerStatusUpdate
operator|.
name|create
argument_list|(
operator|new
name|Timestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|1000
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|2001
argument_list|)
argument_list|,
name|ReviewerStateInternal
operator|.
name|REVIEWER
argument_list|)
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addReviewerUpdate
argument_list|(
name|ReviewerStatusUpdateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setDate
argument_list|(
literal|1212L
argument_list|)
operator|.
name|setUpdatedBy
argument_list|(
literal|1000
argument_list|)
operator|.
name|setReviewer
argument_list|(
literal|2002
argument_list|)
operator|.
name|setState
argument_list|(
literal|"CC"
argument_list|)
argument_list|)
operator|.
name|addReviewerUpdate
argument_list|(
name|ReviewerStatusUpdateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setDate
argument_list|(
literal|3434L
argument_list|)
operator|.
name|setUpdatedBy
argument_list|(
literal|1000
argument_list|)
operator|.
name|setReviewer
argument_list|(
literal|2001
argument_list|)
operator|.
name|setState
argument_list|(
literal|"REVIEWER"
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeSubmitRecords ()
specifier|public
name|void
name|serializeSubmitRecords
parameter_list|()
throws|throws
name|Exception
block|{
name|SubmitRecord
name|sr1
init|=
operator|new
name|SubmitRecord
argument_list|()
decl_stmt|;
name|sr1
operator|.
name|status
operator|=
name|SubmitRecord
operator|.
name|Status
operator|.
name|OK
expr_stmt|;
name|SubmitRecord
name|sr2
init|=
operator|new
name|SubmitRecord
argument_list|()
decl_stmt|;
name|sr2
operator|.
name|status
operator|=
name|SubmitRecord
operator|.
name|Status
operator|.
name|FORCED
expr_stmt|;
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|submitRecords
argument_list|(
name|ImmutableList
operator|.
name|of
argument_list|(
name|sr2
argument_list|,
name|sr1
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addSubmitRecord
argument_list|(
literal|"{\"status\":\"FORCED\"}"
argument_list|)
operator|.
name|addSubmitRecord
argument_list|(
literal|"{\"status\":\"OK\"}"
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeChangeMessages ()
specifier|public
name|void
name|serializeChangeMessages
parameter_list|()
throws|throws
name|Exception
block|{
name|ChangeMessage
name|m1
init|=
operator|new
name|ChangeMessage
argument_list|(
name|ChangeMessage
operator|.
name|key
argument_list|(
name|ID
argument_list|,
literal|"uuid1"
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|1000
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|,
operator|new
name|PatchSet
operator|.
name|Id
argument_list|(
name|ID
argument_list|,
literal|1
argument_list|)
argument_list|)
decl_stmt|;
name|ByteString
name|m1Bytes
init|=
name|toByteString
argument_list|(
name|m1
argument_list|,
name|ChangeMessageProtoConverter
operator|.
name|INSTANCE
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|m1Bytes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|35
argument_list|)
expr_stmt|;
name|ChangeMessage
name|m2
init|=
operator|new
name|ChangeMessage
argument_list|(
name|ChangeMessage
operator|.
name|key
argument_list|(
name|ID
argument_list|,
literal|"uuid2"
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|2000
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|,
operator|new
name|PatchSet
operator|.
name|Id
argument_list|(
name|ID
argument_list|,
literal|2
argument_list|)
argument_list|)
decl_stmt|;
name|ByteString
name|m2Bytes
init|=
name|toByteString
argument_list|(
name|m2
argument_list|,
name|ChangeMessageProtoConverter
operator|.
name|INSTANCE
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|m2Bytes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|35
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|m2Bytes
argument_list|)
operator|.
name|isNotEqualTo
argument_list|(
name|m1Bytes
argument_list|)
expr_stmt|;
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|changeMessages
argument_list|(
name|ImmutableList
operator|.
name|of
argument_list|(
name|m2
argument_list|,
name|m1
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addChangeMessage
argument_list|(
name|m2Bytes
argument_list|)
operator|.
name|addChangeMessage
argument_list|(
name|m1Bytes
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializePublishedComments ()
specifier|public
name|void
name|serializePublishedComments
parameter_list|()
throws|throws
name|Exception
block|{
name|Comment
name|c1
init|=
operator|new
name|Comment
argument_list|(
operator|new
name|Comment
operator|.
name|Key
argument_list|(
literal|"uuid1"
argument_list|,
literal|"file1"
argument_list|,
literal|1
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|1001
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|1212L
argument_list|)
argument_list|,
operator|(
name|short
operator|)
literal|1
argument_list|,
literal|"message 1"
argument_list|,
literal|"serverId"
argument_list|,
literal|false
argument_list|)
decl_stmt|;
name|c1
operator|.
name|setRevId
argument_list|(
operator|new
name|RevId
argument_list|(
literal|"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
argument_list|)
argument_list|)
expr_stmt|;
name|String
name|c1Json
init|=
name|Serializer
operator|.
name|GSON
operator|.
name|toJson
argument_list|(
name|c1
argument_list|)
decl_stmt|;
name|Comment
name|c2
init|=
operator|new
name|Comment
argument_list|(
operator|new
name|Comment
operator|.
name|Key
argument_list|(
literal|"uuid2"
argument_list|,
literal|"file2"
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Account
operator|.
name|id
argument_list|(
literal|1002
argument_list|)
argument_list|,
operator|new
name|Timestamp
argument_list|(
literal|3434L
argument_list|)
argument_list|,
operator|(
name|short
operator|)
literal|2
argument_list|,
literal|"message 2"
argument_list|,
literal|"serverId"
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|c2
operator|.
name|setRevId
argument_list|(
operator|new
name|RevId
argument_list|(
literal|"bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb"
argument_list|)
argument_list|)
expr_stmt|;
name|String
name|c2Json
init|=
name|Serializer
operator|.
name|GSON
operator|.
name|toJson
argument_list|(
name|c2
argument_list|)
decl_stmt|;
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|publishedComments
argument_list|(
name|ImmutableListMultimap
operator|.
name|of
argument_list|(
operator|new
name|RevId
argument_list|(
name|c2
operator|.
name|revId
argument_list|)
argument_list|,
name|c2
argument_list|,
operator|new
name|RevId
argument_list|(
name|c1
operator|.
name|revId
argument_list|)
argument_list|,
name|c1
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|addPublishedComment
argument_list|(
name|c2Json
argument_list|)
operator|.
name|addPublishedComment
argument_list|(
name|c1Json
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|serializeUpdateCount ()
specifier|public
name|void
name|serializeUpdateCount
parameter_list|()
throws|throws
name|Exception
block|{
name|assertRoundTrip
argument_list|(
name|newBuilder
argument_list|()
operator|.
name|updateCount
argument_list|(
literal|234
argument_list|)
operator|.
name|build
argument_list|()
argument_list|,
name|ChangeNotesStateProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setMetaId
argument_list|(
name|SHA_BYTES
argument_list|)
operator|.
name|setChangeId
argument_list|(
name|ID
operator|.
name|get
argument_list|()
argument_list|)
operator|.
name|setColumns
argument_list|(
name|colsProto
argument_list|)
operator|.
name|setUpdateCount
argument_list|(
literal|234
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|changeNotesStateMethods ()
specifier|public
name|void
name|changeNotesStateMethods
parameter_list|()
throws|throws
name|Exception
block|{
name|assertThatSerializedClass
argument_list|(
name|ChangeNotesState
operator|.
name|class
argument_list|)
operator|.
name|hasAutoValueMethods
argument_list|(
name|ImmutableMap
operator|.
expr|<
name|String
argument_list|,
name|Type
operator|>
name|builder
argument_list|()
operator|.
name|put
argument_list|(
literal|"metaId"
argument_list|,
name|ObjectId
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"changeId"
argument_list|,
name|Change
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"columns"
argument_list|,
name|ChangeColumns
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"pastAssignees"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableSet
argument_list|<
name|Account
operator|.
name|Id
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
operator|.
name|put
argument_list|(
literal|"hashtags"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableSet
argument_list|<
name|String
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
operator|.
name|put
argument_list|(
literal|"patchSets"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableList
argument_list|<
name|Map
operator|.
name|Entry
argument_list|<
name|PatchSet
operator|.
name|Id
argument_list|,
name|PatchSet
argument_list|>
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
operator|.
name|put
argument_list|(
literal|"approvals"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableList
argument_list|<
name|Map
operator|.
name|Entry
argument_list|<
name|PatchSet
operator|.
name|Id
argument_list|,
name|PatchSetApproval
argument_list|>
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
operator|.
name|put
argument_list|(
literal|"reviewers"
argument_list|,
name|ReviewerSet
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"reviewersByEmail"
argument_list|,
name|ReviewerByEmailSet
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"pendingReviewers"
argument_list|,
name|ReviewerSet
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"pendingReviewersByEmail"
argument_list|,
name|ReviewerByEmailSet
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"allPastReviewers"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableList
argument_list|<
name|Account
operator|.
name|Id
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
operator|.
name|put
argument_list|(
literal|"reviewerUpdates"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableList
argument_list|<
name|ReviewerStatusUpdate
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
operator|.
name|put
argument_list|(
literal|"submitRecords"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableList
argument_list|<
name|SubmitRecord
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
operator|.
name|put
argument_list|(
literal|"changeMessages"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableList
argument_list|<
name|ChangeMessage
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
operator|.
name|put
argument_list|(
literal|"publishedComments"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableListMultimap
argument_list|<
name|RevId
argument_list|,
name|Comment
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
operator|.
name|put
argument_list|(
literal|"updateCount"
argument_list|,
name|int
operator|.
name|class
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|changeColumnsMethods ()
specifier|public
name|void
name|changeColumnsMethods
parameter_list|()
throws|throws
name|Exception
block|{
name|assertThatSerializedClass
argument_list|(
name|ChangeColumns
operator|.
name|class
argument_list|)
operator|.
name|hasAutoValueMethods
argument_list|(
name|ImmutableMap
operator|.
expr|<
name|String
argument_list|,
name|Type
operator|>
name|builder
argument_list|()
operator|.
name|put
argument_list|(
literal|"changeKey"
argument_list|,
name|Change
operator|.
name|Key
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"createdOn"
argument_list|,
name|Timestamp
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"lastUpdatedOn"
argument_list|,
name|Timestamp
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"owner"
argument_list|,
name|Account
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"branch"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"currentPatchSetId"
argument_list|,
name|PatchSet
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"subject"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"topic"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"originalSubject"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"submissionId"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"assignee"
argument_list|,
name|Account
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"status"
argument_list|,
name|Change
operator|.
name|Status
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"isPrivate"
argument_list|,
name|boolean
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"workInProgress"
argument_list|,
name|boolean
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"reviewStarted"
argument_list|,
name|boolean
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"revertOf"
argument_list|,
name|Change
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"toBuilder"
argument_list|,
name|ChangeNotesState
operator|.
name|ChangeColumns
operator|.
name|Builder
operator|.
name|class
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|patchSetFields ()
specifier|public
name|void
name|patchSetFields
parameter_list|()
throws|throws
name|Exception
block|{
name|assertThatSerializedClass
argument_list|(
name|PatchSet
operator|.
name|class
argument_list|)
operator|.
name|hasFields
argument_list|(
name|ImmutableMap
operator|.
expr|<
name|String
argument_list|,
name|Type
operator|>
name|builder
argument_list|()
operator|.
name|put
argument_list|(
literal|"id"
argument_list|,
name|PatchSet
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"revision"
argument_list|,
name|RevId
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"uploader"
argument_list|,
name|Account
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"createdOn"
argument_list|,
name|Timestamp
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"groups"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"pushCertificate"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"description"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|patchSetApprovalFields ()
specifier|public
name|void
name|patchSetApprovalFields
parameter_list|()
throws|throws
name|Exception
block|{
name|assertThatSerializedClass
argument_list|(
name|PatchSetApproval
operator|.
name|Key
operator|.
name|class
argument_list|)
operator|.
name|hasAutoValueMethods
argument_list|(
name|ImmutableMap
operator|.
expr|<
name|String
argument_list|,
name|Type
operator|>
name|builder
argument_list|()
operator|.
name|put
argument_list|(
literal|"patchSetId"
argument_list|,
name|PatchSet
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"accountId"
argument_list|,
name|Account
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"labelId"
argument_list|,
name|LabelId
operator|.
name|class
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
name|assertThatSerializedClass
argument_list|(
name|PatchSetApproval
operator|.
name|class
argument_list|)
operator|.
name|hasFields
argument_list|(
name|ImmutableMap
operator|.
expr|<
name|String
argument_list|,
name|Type
operator|>
name|builder
argument_list|()
operator|.
name|put
argument_list|(
literal|"key"
argument_list|,
name|PatchSetApproval
operator|.
name|Key
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"value"
argument_list|,
name|short
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"granted"
argument_list|,
name|Timestamp
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"tag"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"realAccountId"
argument_list|,
name|Account
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"postSubmit"
argument_list|,
name|boolean
operator|.
name|class
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|reviewerSetFields ()
specifier|public
name|void
name|reviewerSetFields
parameter_list|()
throws|throws
name|Exception
block|{
name|assertThatSerializedClass
argument_list|(
name|ReviewerSet
operator|.
name|class
argument_list|)
operator|.
name|hasFields
argument_list|(
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"table"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableTable
argument_list|<
name|ReviewerStateInternal
argument_list|,
name|Account
operator|.
name|Id
argument_list|,
name|Timestamp
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|,
literal|"accounts"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableSet
argument_list|<
name|Account
operator|.
name|Id
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|reviewerByEmailSetFields ()
specifier|public
name|void
name|reviewerByEmailSetFields
parameter_list|()
throws|throws
name|Exception
block|{
name|assertThatSerializedClass
argument_list|(
name|ReviewerByEmailSet
operator|.
name|class
argument_list|)
operator|.
name|hasFields
argument_list|(
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"table"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableTable
argument_list|<
name|ReviewerStateInternal
argument_list|,
name|Address
argument_list|,
name|Timestamp
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|,
literal|"users"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableSet
argument_list|<
name|Address
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|reviewerStatusUpdateMethods ()
specifier|public
name|void
name|reviewerStatusUpdateMethods
parameter_list|()
throws|throws
name|Exception
block|{
name|assertThatSerializedClass
argument_list|(
name|ReviewerStatusUpdate
operator|.
name|class
argument_list|)
operator|.
name|hasAutoValueMethods
argument_list|(
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"date"
argument_list|,
name|Timestamp
operator|.
name|class
argument_list|,
literal|"updatedBy"
argument_list|,
name|Account
operator|.
name|Id
operator|.
name|class
argument_list|,
literal|"reviewer"
argument_list|,
name|Account
operator|.
name|Id
operator|.
name|class
argument_list|,
literal|"state"
argument_list|,
name|ReviewerStateInternal
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|submitRecordFields ()
specifier|public
name|void
name|submitRecordFields
parameter_list|()
throws|throws
name|Exception
block|{
name|assertThatSerializedClass
argument_list|(
name|SubmitRecord
operator|.
name|class
argument_list|)
operator|.
name|hasFields
argument_list|(
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"status"
argument_list|,
name|SubmitRecord
operator|.
name|Status
operator|.
name|class
argument_list|,
literal|"labels"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|List
argument_list|<
name|SubmitRecord
operator|.
name|Label
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|,
literal|"requirements"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|List
argument_list|<
name|SubmitRequirement
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|,
literal|"errorMessage"
argument_list|,
name|String
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|assertThatSerializedClass
argument_list|(
name|SubmitRecord
operator|.
name|Label
operator|.
name|class
argument_list|)
operator|.
name|hasFields
argument_list|(
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"label"
argument_list|,
name|String
operator|.
name|class
argument_list|,
literal|"status"
argument_list|,
name|SubmitRecord
operator|.
name|Label
operator|.
name|Status
operator|.
name|class
argument_list|,
literal|"appliedBy"
argument_list|,
name|Account
operator|.
name|Id
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|assertThatSerializedClass
argument_list|(
name|SubmitRequirement
operator|.
name|class
argument_list|)
operator|.
name|hasAutoValueMethods
argument_list|(
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"fallbackText"
argument_list|,
name|String
operator|.
name|class
argument_list|,
literal|"type"
argument_list|,
name|String
operator|.
name|class
argument_list|,
literal|"data"
argument_list|,
operator|new
name|TypeLiteral
argument_list|<
name|ImmutableMap
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
argument_list|>
argument_list|()
block|{}
operator|.
name|getType
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|changeMessageFields ()
specifier|public
name|void
name|changeMessageFields
parameter_list|()
throws|throws
name|Exception
block|{
name|assertThatSerializedClass
argument_list|(
name|ChangeMessage
operator|.
name|Key
operator|.
name|class
argument_list|)
operator|.
name|hasAutoValueMethods
argument_list|(
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"changeId"
argument_list|,
name|Change
operator|.
name|Id
operator|.
name|class
argument_list|,
literal|"uuid"
argument_list|,
name|String
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|assertThatSerializedClass
argument_list|(
name|ChangeMessage
operator|.
name|class
argument_list|)
operator|.
name|hasFields
argument_list|(
name|ImmutableMap
operator|.
expr|<
name|String
argument_list|,
name|Type
operator|>
name|builder
argument_list|()
operator|.
name|put
argument_list|(
literal|"key"
argument_list|,
name|ChangeMessage
operator|.
name|Key
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"author"
argument_list|,
name|Account
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"writtenOn"
argument_list|,
name|Timestamp
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"message"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"patchset"
argument_list|,
name|PatchSet
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"tag"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"realAuthor"
argument_list|,
name|Account
operator|.
name|Id
operator|.
name|class
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|commentFields ()
specifier|public
name|void
name|commentFields
parameter_list|()
throws|throws
name|Exception
block|{
name|assertThatSerializedClass
argument_list|(
name|Comment
operator|.
name|Key
operator|.
name|class
argument_list|)
operator|.
name|hasFields
argument_list|(
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"uuid"
argument_list|,
name|String
operator|.
name|class
argument_list|,
literal|"filename"
argument_list|,
name|String
operator|.
name|class
argument_list|,
literal|"patchSetId"
argument_list|,
name|int
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|assertThatSerializedClass
argument_list|(
name|Comment
operator|.
name|Identity
operator|.
name|class
argument_list|)
operator|.
name|hasFields
argument_list|(
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"id"
argument_list|,
name|int
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|assertThatSerializedClass
argument_list|(
name|Comment
operator|.
name|Range
operator|.
name|class
argument_list|)
operator|.
name|hasFields
argument_list|(
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"startLine"
argument_list|,
name|int
operator|.
name|class
argument_list|,
literal|"startChar"
argument_list|,
name|int
operator|.
name|class
argument_list|,
literal|"endLine"
argument_list|,
name|int
operator|.
name|class
argument_list|,
literal|"endChar"
argument_list|,
name|int
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|assertThatSerializedClass
argument_list|(
name|Comment
operator|.
name|class
argument_list|)
operator|.
name|hasFields
argument_list|(
name|ImmutableMap
operator|.
expr|<
name|String
argument_list|,
name|Type
operator|>
name|builder
argument_list|()
operator|.
name|put
argument_list|(
literal|"key"
argument_list|,
name|Comment
operator|.
name|Key
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"lineNbr"
argument_list|,
name|int
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"author"
argument_list|,
name|Comment
operator|.
name|Identity
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"realAuthor"
argument_list|,
name|Comment
operator|.
name|Identity
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"writtenOn"
argument_list|,
name|Timestamp
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"side"
argument_list|,
name|short
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"message"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"parentUuid"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"range"
argument_list|,
name|Comment
operator|.
name|Range
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"tag"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"revId"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"serverId"
argument_list|,
name|String
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"unresolved"
argument_list|,
name|boolean
operator|.
name|class
argument_list|)
operator|.
name|put
argument_list|(
literal|"legacyFormat"
argument_list|,
name|boolean
operator|.
name|class
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|toProto (ChangeNotesState state)
specifier|private
specifier|static
name|ChangeNotesStateProto
name|toProto
parameter_list|(
name|ChangeNotesState
name|state
parameter_list|)
throws|throws
name|Exception
block|{
return|return
name|ChangeNotesStateProto
operator|.
name|parseFrom
argument_list|(
name|Serializer
operator|.
name|INSTANCE
operator|.
name|serialize
argument_list|(
name|state
argument_list|)
argument_list|)
return|;
block|}
DECL|method|assertRoundTrip ( ChangeNotesState state, ChangeNotesStateProto expectedProto)
specifier|private
specifier|static
name|ChangeNotesState
name|assertRoundTrip
parameter_list|(
name|ChangeNotesState
name|state
parameter_list|,
name|ChangeNotesStateProto
name|expectedProto
parameter_list|)
throws|throws
name|Exception
block|{
name|ChangeNotesStateProto
name|actualProto
init|=
name|toProto
argument_list|(
name|state
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|actualProto
argument_list|)
operator|.
name|isEqualTo
argument_list|(
name|expectedProto
argument_list|)
expr_stmt|;
name|ChangeNotesState
name|actual
init|=
name|Serializer
operator|.
name|INSTANCE
operator|.
name|deserialize
argument_list|(
name|Serializer
operator|.
name|INSTANCE
operator|.
name|serialize
argument_list|(
name|state
argument_list|)
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|actual
argument_list|)
operator|.
name|isEqualTo
argument_list|(
name|state
argument_list|)
expr_stmt|;
comment|// It's possible that ChangeNotesState contains objects which implement equals without taking
comment|// into account all fields. Return the actual deserialized instance so that callers can perform
comment|// additional assertions if necessary.
return|return
name|actual
return|;
block|}
block|}
end_class

end_unit

