begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|// Copyright (C) 2016 The Android Open Source Project
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// Licensed under the Apache License, Version 2.0 (the "License");
end_comment

begin_comment
comment|// you may not use this file except in compliance with the License.
end_comment

begin_comment
comment|// You may obtain a copy of the License at
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// http://www.apache.org/licenses/LICENSE-2.0
end_comment

begin_comment
comment|//
end_comment

begin_comment
comment|// Unless required by applicable law or agreed to in writing, software
end_comment

begin_comment
comment|// distributed under the License is distributed on an "AS IS" BASIS,
end_comment

begin_comment
comment|// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
end_comment

begin_comment
comment|// See the License for the specific language governing permissions and
end_comment

begin_comment
comment|// limitations under the License.
end_comment

begin_package
DECL|package|com.google.gerrit.acceptance.ssh
package|package
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|acceptance
operator|.
name|ssh
package|;
end_package

begin_import
import|import static
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|truth
operator|.
name|Truth
operator|.
name|assertThat
import|;
end_import

begin_import
import|import static
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|truth
operator|.
name|Truth
operator|.
name|assert_
import|;
end_import

begin_import
import|import static
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|acceptance
operator|.
name|GitUtil
operator|.
name|initSsh
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|Lists
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|acceptance
operator|.
name|AbstractDaemonTest
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|acceptance
operator|.
name|NoHttpd
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|acceptance
operator|.
name|PushOneCommit
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|acceptance
operator|.
name|SshSession
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|extensions
operator|.
name|api
operator|.
name|changes
operator|.
name|AddReviewerInput
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|extensions
operator|.
name|api
operator|.
name|changes
operator|.
name|ReviewInput
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|extensions
operator|.
name|client
operator|.
name|Side
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gerrit
operator|.
name|server
operator|.
name|data
operator|.
name|ChangeAttribute
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gson
operator|.
name|Gson
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_class
annotation|@
name|NoHttpd
DECL|class|QueryIT
specifier|public
class|class
name|QueryIT
extends|extends
name|AbstractDaemonTest
block|{
DECL|field|gson
specifier|private
specifier|static
name|Gson
name|gson
init|=
operator|new
name|Gson
argument_list|()
decl_stmt|;
annotation|@
name|Test
DECL|method|testBasicQueryJSON ()
specifier|public
name|void
name|testBasicQueryJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId1
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|String
name|changeId2
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
literal|"1234"
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
name|changeId1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|project
argument_list|)
operator|.
name|isEqualTo
argument_list|(
name|project
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|id
argument_list|)
operator|.
name|isEqualTo
argument_list|(
name|changeId1
argument_list|)
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
name|changeId1
operator|+
literal|" OR "
operator|+
name|changeId2
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|project
argument_list|)
operator|.
name|isEqualTo
argument_list|(
name|project
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|id
argument_list|)
operator|.
name|isEqualTo
argument_list|(
name|changeId2
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|1
argument_list|)
operator|.
name|project
argument_list|)
operator|.
name|isEqualTo
argument_list|(
name|project
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|1
argument_list|)
operator|.
name|id
argument_list|)
operator|.
name|isEqualTo
argument_list|(
name|changeId1
argument_list|)
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--start=1 "
operator|+
name|changeId1
operator|+
literal|" OR "
operator|+
name|changeId2
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|project
argument_list|)
operator|.
name|isEqualTo
argument_list|(
name|project
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|id
argument_list|)
operator|.
name|isEqualTo
argument_list|(
name|changeId1
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAllApprovalsOptionJSON ()
specifier|public
name|void
name|testAllApprovalsOptionJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|gApi
operator|.
name|changes
argument_list|()
operator|.
name|id
argument_list|(
name|changeId
argument_list|)
operator|.
name|current
argument_list|()
operator|.
name|review
argument_list|(
name|ReviewInput
operator|.
name|approve
argument_list|()
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
name|changeId
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--all-approvals "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|approvals
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|approvals
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAllReviewersOptionJSON ()
specifier|public
name|void
name|testAllReviewersOptionJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|AddReviewerInput
name|in
init|=
operator|new
name|AddReviewerInput
argument_list|()
decl_stmt|;
name|in
operator|.
name|reviewer
operator|=
name|user
operator|.
name|email
expr_stmt|;
name|gApi
operator|.
name|changes
argument_list|()
operator|.
name|id
argument_list|(
name|changeId
argument_list|)
operator|.
name|addReviewer
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
name|changeId
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|allReviewers
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--all-reviewers "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|allReviewers
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|allReviewers
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testCommitMessageOptionJSON ()
specifier|public
name|void
name|testCommitMessageOptionJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
literal|"--commit-message "
operator|+
name|changeId
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|commitMessage
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|commitMessage
argument_list|)
operator|.
name|contains
argument_list|(
name|PushOneCommit
operator|.
name|SUBJECT
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testCurrentPatchSetOptionJSON ()
specifier|public
name|void
name|testCurrentPatchSetOptionJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|amendChange
argument_list|(
name|changeId
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
name|changeId
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--current-patch-set "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
operator|.
name|number
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|"2"
argument_list|)
expr_stmt|;
name|gApi
operator|.
name|changes
argument_list|()
operator|.
name|id
argument_list|(
name|changeId
argument_list|)
operator|.
name|current
argument_list|()
operator|.
name|review
argument_list|(
name|ReviewInput
operator|.
name|approve
argument_list|()
argument_list|)
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--current-patch-set "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
operator|.
name|approvals
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
operator|.
name|approvals
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testPatchSetsOptionJSON ()
specifier|public
name|void
name|testPatchSetsOptionJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|amendChange
argument_list|(
name|changeId
argument_list|)
expr_stmt|;
name|amendChange
argument_list|(
name|changeId
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
name|changeId
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--patch-sets "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|3
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|shouldFailWithFilesWithoutPatchSetsOrCurrentPatchSetsOption ()
specifier|public
name|void
name|shouldFailWithFilesWithoutPatchSetsOrCurrentPatchSetsOption
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|adminSshSession
operator|.
name|exec
argument_list|(
literal|"gerrit query --files "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|adminSshSession
operator|.
name|hasError
argument_list|()
argument_list|)
operator|.
name|isTrue
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|adminSshSession
operator|.
name|getError
argument_list|()
argument_list|)
operator|.
name|contains
argument_list|(
literal|"needs --patch-sets or --current-patch-set"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testFileOptionJSON ()
specifier|public
name|void
name|testFileOptionJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
literal|"--current-patch-set --files "
operator|+
name|changeId
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
operator|.
name|files
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
operator|.
name|files
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--patch-sets --files "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|files
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|files
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|gApi
operator|.
name|changes
argument_list|()
operator|.
name|id
argument_list|(
name|changeId
argument_list|)
operator|.
name|current
argument_list|()
operator|.
name|review
argument_list|(
name|ReviewInput
operator|.
name|approve
argument_list|()
argument_list|)
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--patch-sets --files --all-approvals "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|files
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|files
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|approvals
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|approvals
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testCommentOptionJSON ()
specifier|public
name|void
name|testCommentOptionJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
name|changeId
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|comments
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--comments "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|comments
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|comments
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testCommentOptionsInCurrentPatchSetJSON ()
specifier|public
name|void
name|testCommentOptionsInCurrentPatchSetJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|ReviewInput
name|review
init|=
operator|new
name|ReviewInput
argument_list|()
decl_stmt|;
name|ReviewInput
operator|.
name|CommentInput
name|comment
init|=
operator|new
name|ReviewInput
operator|.
name|CommentInput
argument_list|()
decl_stmt|;
name|comment
operator|.
name|path
operator|=
name|PushOneCommit
operator|.
name|FILE_NAME
expr_stmt|;
name|comment
operator|.
name|side
operator|=
name|Side
operator|.
name|REVISION
expr_stmt|;
name|comment
operator|.
name|message
operator|=
literal|"comment 1"
expr_stmt|;
name|review
operator|.
name|comments
operator|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
expr_stmt|;
name|review
operator|.
name|comments
operator|.
name|put
argument_list|(
name|comment
operator|.
name|path
argument_list|,
name|Lists
operator|.
name|newArrayList
argument_list|(
name|comment
argument_list|)
argument_list|)
expr_stmt|;
name|gApi
operator|.
name|changes
argument_list|()
operator|.
name|id
argument_list|(
name|changeId
argument_list|)
operator|.
name|current
argument_list|()
operator|.
name|review
argument_list|(
name|review
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
literal|"--current-patch-set "
operator|+
name|changeId
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
operator|.
name|comments
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--current-patch-set --comments "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
operator|.
name|comments
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
operator|.
name|comments
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testCommentOptionInPatchSetsJSON ()
specifier|public
name|void
name|testCommentOptionInPatchSetsJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|ReviewInput
name|review
init|=
operator|new
name|ReviewInput
argument_list|()
decl_stmt|;
name|ReviewInput
operator|.
name|CommentInput
name|comment
init|=
operator|new
name|ReviewInput
operator|.
name|CommentInput
argument_list|()
decl_stmt|;
name|comment
operator|.
name|path
operator|=
name|PushOneCommit
operator|.
name|FILE_NAME
expr_stmt|;
name|comment
operator|.
name|side
operator|=
name|Side
operator|.
name|REVISION
expr_stmt|;
name|comment
operator|.
name|message
operator|=
literal|"comment 1"
expr_stmt|;
name|review
operator|.
name|comments
operator|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
expr_stmt|;
name|review
operator|.
name|comments
operator|.
name|put
argument_list|(
name|comment
operator|.
name|path
argument_list|,
name|Lists
operator|.
name|newArrayList
argument_list|(
name|comment
argument_list|)
argument_list|)
expr_stmt|;
name|gApi
operator|.
name|changes
argument_list|()
operator|.
name|id
argument_list|(
name|changeId
argument_list|)
operator|.
name|current
argument_list|()
operator|.
name|review
argument_list|(
name|review
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
literal|"--patch-sets "
operator|+
name|changeId
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|comments
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--patch-sets --comments "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|comments
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|comments
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--patch-sets --comments --files "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|comments
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|comments
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|files
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|files
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|gApi
operator|.
name|changes
argument_list|()
operator|.
name|id
argument_list|(
name|changeId
argument_list|)
operator|.
name|current
argument_list|()
operator|.
name|review
argument_list|(
name|ReviewInput
operator|.
name|approve
argument_list|()
argument_list|)
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--patch-sets --comments --files --all-approvals "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|comments
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|comments
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|files
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|files
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|approvals
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|approvals
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testDependenciesOptionJSON ()
specifier|public
name|void
name|testDependenciesOptionJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId1
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|String
name|changeId2
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
name|changeId1
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|dependsOn
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--dependencies "
operator|+
name|changeId1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|dependsOn
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
name|changeId2
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|dependsOn
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--dependencies "
operator|+
name|changeId2
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|dependsOn
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|dependsOn
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testSubmitRecordsOptionJSON ()
specifier|public
name|void
name|testSubmitRecordsOptionJSON
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
name|changeId
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|submitRecords
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
literal|"--submit-records "
operator|+
name|changeId
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|submitRecords
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|submitRecords
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testQueryWithNonVisibleCurrentPatchSet ()
specifier|public
name|void
name|testQueryWithNonVisibleCurrentPatchSet
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|changeId
init|=
name|createChange
argument_list|()
operator|.
name|getChangeId
argument_list|()
decl_stmt|;
name|amendChangeAsDraft
argument_list|(
name|changeId
argument_list|)
expr_stmt|;
name|String
name|query
init|=
literal|"--current-patch-set --patch-sets "
operator|+
name|changeId
decl_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
name|executeSuccessfulQuery
argument_list|(
name|query
argument_list|)
decl_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
argument_list|)
operator|.
name|hasSize
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
argument_list|)
operator|.
name|isNotNull
argument_list|()
expr_stmt|;
name|SshSession
name|userSession
init|=
operator|new
name|SshSession
argument_list|(
name|server
argument_list|,
name|user
argument_list|)
decl_stmt|;
name|initSsh
argument_list|(
name|user
argument_list|)
expr_stmt|;
name|userSession
operator|.
name|open
argument_list|()
expr_stmt|;
name|changes
operator|=
name|executeSuccessfulQuery
argument_list|(
name|query
argument_list|,
name|userSession
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|size
argument_list|()
argument_list|)
operator|.
name|isEqualTo
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|patchSets
argument_list|)
operator|.
name|hasSize
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|assertThat
argument_list|(
name|changes
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|currentPatchSet
argument_list|)
operator|.
name|isNull
argument_list|()
expr_stmt|;
name|userSession
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
DECL|method|executeSuccessfulQuery (String params, SshSession session)
specifier|private
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|executeSuccessfulQuery
parameter_list|(
name|String
name|params
parameter_list|,
name|SshSession
name|session
parameter_list|)
throws|throws
name|Exception
block|{
name|String
name|rawResponse
init|=
name|session
operator|.
name|exec
argument_list|(
literal|"gerrit query --format=JSON "
operator|+
name|params
argument_list|)
decl_stmt|;
name|assert_
argument_list|()
operator|.
name|withFailureMessage
argument_list|(
name|session
operator|.
name|getError
argument_list|()
argument_list|)
operator|.
name|that
argument_list|(
name|session
operator|.
name|hasError
argument_list|()
argument_list|)
operator|.
name|isFalse
argument_list|()
expr_stmt|;
return|return
name|getChanges
argument_list|(
name|rawResponse
argument_list|)
return|;
block|}
DECL|method|executeSuccessfulQuery (String params)
specifier|private
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|executeSuccessfulQuery
parameter_list|(
name|String
name|params
parameter_list|)
throws|throws
name|Exception
block|{
return|return
name|executeSuccessfulQuery
argument_list|(
name|params
argument_list|,
name|adminSshSession
argument_list|)
return|;
block|}
DECL|method|getChanges (String rawResponse)
specifier|private
specifier|static
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|getChanges
parameter_list|(
name|String
name|rawResponse
parameter_list|)
block|{
name|String
index|[]
name|lines
init|=
name|rawResponse
operator|.
name|split
argument_list|(
literal|"\\n"
argument_list|)
decl_stmt|;
name|List
argument_list|<
name|ChangeAttribute
argument_list|>
name|changes
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|(
name|lines
operator|.
name|length
operator|-
literal|1
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|lines
operator|.
name|length
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
name|changes
operator|.
name|add
argument_list|(
name|gson
operator|.
name|fromJson
argument_list|(
name|lines
index|[
name|i
index|]
argument_list|,
name|ChangeAttribute
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|changes
return|;
block|}
block|}
end_class

end_unit

